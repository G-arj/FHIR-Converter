{% mergeDiff msg -%}
{
  "use" : "claim", 
  {% if msg.provider == null -%}
  "provider" : {{msg.organization | to_json_string}},
  {% endif -%}
  "payee" : 
  {% mergeDiff msg.payee %}
  {
    "resourceType" : ""
  }
  {% endmergeDiff %},
  "supportingInfo" : {{msg.information | to_json_string}},
  "item" : [
    {% for i in msg.item %}
    {% mergeDiff i %}
    {
      "careTeamSequence" : {{i.careTeamLinkId | to_json_string}},
      "diagnosisSequence" : {{i.diagnosisLinkId | to_json_string}},
      "procedureSequence" : {{i.procedureLinkId | to_json_string}},
      "informationSequence" : {{i.informationLinkId | to_json_string}},
      "productOrService" : {{i.service | to_json_string}},
      "diagnosisCodeableConcept" : {{i.locationCodeableConcept | to_json_string}},
      "careTeamLinkId" : "",
      "diagnosisLinkId" : "",
      "procedureLinkId" : "",
      "informationLinkId" : "",
      "service": "",
      "locationCodeableConcept" : "",
      "unitPrice" : {% include 'Shared/Money' msg: i.unitPrice -%},
      "net" : {% include 'Shared/Money' msg: i.net -%},
      "detail" : [
        {% for d in i.detail %}
        {% mergeDiff d %}
        {
          "productOrService" : {{d.service | to_json_string}},
          "unitPrice" : {% include 'Shared/Money' msg: d.unitPrice -%},
          "net" : {% include 'Shared/Money' msg: d.net -%},
          "service": "",
          "subDetail" : [
            {% for s in d.subDetail %}
            {% mergeDiff s %}
            {
              "productOrService" : {{s.service | to_json_string}},
              "unitPrice" : {% include 'Shared/Money' msg: s.unitPrice -%},
              "net" : {% include 'Shared/Money' msg: s.net -%},
              "service": ""
            }
            {% endmergeDiff %},
            {% endfor %}
          ]
        }
        {% endmergeDiff %},
        {% endfor %}
      ]
    }
    {% endmergeDiff %},
    {% endfor %}
  ],
  "total" : {% include 'Shared/Money' msg: msg.total -%},
  "hospitalization" : "",
  "employmentImpacted" : "",
  "information" : "",
  "organization" : ""
}
{% endmergeDiff -%}

